<?php

/**
 * @file
 * Primary module hooks for Event Registration module.
 */

use Drupal\Core\Render\Markup;

/**
 * Implements hook_mail().
 */
function event_registration_mail($key, &$message, $params) {
  switch ($key) {
    case 'user_confirmation':
      $message['subject'] = t('Registration Confirmation - @event_name', [
        '@event_name' => $params['event_name'],
      ]);
      
      $body = [
        '#theme' => 'event_registration_confirmation',
        '#full_name' => $params['full_name'],
        '#event_name' => $params['event_name'],
        '#event_date' => $params['event_date'],
        '#category' => $params['category'],
      ];
      
      $message['body'][] = \Drupal::service('renderer')->renderPlain($body);
      break;

    case 'admin_notification':
      $message['subject'] = t('New Registration - @event_name', [
        '@event_name' => $params['event_name'],
      ]);
      
      $body = [
        '#theme' => 'event_registration_admin_notification',
        '#full_name' => $params['full_name'],
        '#email' => $params['email'],
        '#event_name' => $params['event_name'],
        '#event_date' => $params['event_date'],
        '#category' => $params['category'],
        '#college' => $params['college'],
        '#department' => $params['department'],
      ];
      
      $message['body'][] = \Drupal::service('renderer')->renderPlain($body);
      break;
  }
}

/**
 * Implements hook_theme().
 */
function event_registration_theme($existing, $type, $theme, $path) {
  return [
    'event_registration_confirmation' => [
      'variables' => [
        'full_name' => NULL,
        'event_name' => NULL,
        'event_date' => NULL,
        'category' => NULL,
      ],
      'template' => 'event-registration-confirmation',
    ],
    'event_registration_admin_notification' => [
      'variables' => [
        'full_name' => NULL,
        'email' => NULL,
        'event_name' => NULL,
        'event_date' => NULL,
        'category' => NULL,
        'college' => NULL,
        'department' => NULL,
      ],
      'template' => 'event-registration-admin-notification',
    ],
  ];
}
